image: lorisleiva/laravel-docker

stages:
  - deploy

before_script:
  - composer install --no-dev --prefer-dist --optimize-autoloader
  - echo "APP_NAME=$APPNAME" > .env
  - echo "APP_ENV=$APPENV" >> .env
  - echo "APP_KEY=$APPKEY" >> .env
  - echo "APP_DEBUG=$APPDEBUG" >> .env
  - echo "APP_URL=$APPURL" >> .env
  - echo "DB_CONNECTION=$DBCONNECTION" >> .env
  - echo "DB_HOST=$DBHOST" >> .env
  - echo "DB_PORT=$DBPORT" >> .env
  - echo "DB_DATABASE=$DBDATABASE" >> .env
  - echo "DB_USERNAME=$DBUSERNAME" >> .env
  - echo "DB_PASSWORD=$DBPASSWORD" >> .env
  - php artisan config:cache
  - php artisan route:cache
  - php artisan view:cache

deploy_production:
  stage: deploy
  script:
    - apt-get update -qq && apt-get install -y -qq lftp
    - lftp -c "open -u $FTPUSER,$FTPPASS $FTPHOST; mirror -R ./ /public_html"
  only:
    - master
